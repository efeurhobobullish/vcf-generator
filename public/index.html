<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectMe | Temporary Contact Links</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'wave': 'wave 1.5s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        wave: {
                            '0%': { transform: 'rotate(0deg)' },
                            '10%': { transform: 'rotate(14deg)' },
                            '20%': { transform: 'rotate(-8deg)' },
                            '30%': { transform: 'rotate(14deg)' },
                            '40%': { transform: 'rotate(-4deg)' },
                            '50%': { transform: 'rotate(10deg)' },
                            '60%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(0deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #fdf2f8 100%);
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #ec4899 0%, #7c3aed 50%, #0ea5e9 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .blob {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.3;
            z-index: -1;
        }
        
        .blob-1 {
            background: #7c3aed;
            top: -100px;
            left: -100px;
            animation: float 8s ease-in-out infinite;
        }
        
        .blob-2 {
            background: #ec4899;
            bottom: -100px;
            right: -100px;
            animation: float 10s ease-in-out infinite reverse;
        }
        
        .card {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #ec4899 0%, #7c3aed 50%, #0ea5e9 100%);
            background-size: 200% auto;
            transition: 0.5s;
        }
        
        .btn-primary:hover {
            background-position: right center;
        }
        
        .duration-btn {
            transition: all 0.3s ease;
        }
        
        .duration-btn:hover {
            transform: translateY(-3px);
        }
        
        .success-check {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4ade80 0%, #22d3ee 100%);
            margin: 0 auto;
            animation: bounceIn 0.6s;
        }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden">
    <!-- Background blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    
    <div x-data="app()" x-init="init()" class="container mx-auto px-4 py-12">
        <!-- Header -->
        <header class="text-center mb-16 animate__animated animate__fadeIn">
            <h1 class="text-5xl font-bold gradient-text mb-4">ConnectMe</h1>
            <p class="text-lg text-gray-600 max-w-lg mx-auto">Create beautiful temporary contact links that expire after your chosen duration</p>
        </header>

        <!-- Main Content -->
        <div class="max-w-md mx-auto card rounded-2xl p-8 animate__animated animate__fadeInUp">
            <!-- Step 1: Create Session -->
            <div x-show="step === 1" x-transition>
                <h2 class="text-2xl font-semibold text-gray-800 mb-8 text-center">Create New Link</h2>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-3 font-medium" for="name">Your Name</label>
                    <div class="relative">
                        <input 
                            x-model="name" 
                            type="text" 
                            id="name" 
                            class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary-200 focus:border-primary-500 outline-none transition placeholder-gray-400"
                            placeholder="e.g. Empire Tech"
                        >
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="mb-8">
                    <label class="block text-gray-700 mb-3 font-medium">Link Duration</label>
                    <div class="grid grid-cols-4 gap-3">
                        <template x-for="duration in durations">
                            <button 
                                @click="selectedDuration = duration.value"
                                :class="{
                                    'bg-primary-500 text-white shadow-lg scale-105': selectedDuration === duration.value, 
                                    'bg-white text-gray-800 shadow-md': selectedDuration !== duration.value
                                }"
                                class="duration-btn py-3 px-2 rounded-xl font-medium transition-all"
                                x-text="duration.label">
                            </button>
                        </template>
                    </div>
                </div>
                
                <button 
                    @click="createSession()"
                    :disabled="!name || !selectedDuration"
                    :class="{
                        'opacity-70 cursor-not-allowed': !name || !selectedDuration, 
                        'hover:shadow-xl': name && selectedDuration
                    }"
                    class="btn-primary w-full text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center shadow-lg">
                    <span x-show="!loading" class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        Generate Link
                    </span>
                    <svg x-show="loading" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Step 2: Show Generated Link -->
            <div x-show="step === 2" x-transition class="text-center">
                <div class="mb-8 animate__animated animate__bounceIn">
                    <div class="success-check">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800 mt-6">Link Ready!</h2>
                    <p class="text-gray-600 mt-2">Share this link to collect contacts</p>
                </div>
                
                <div class="bg-gray-50 p-5 rounded-xl mb-8 border border-gray-100">
                    <p class="text-sm text-gray-500 mb-3">Expires in: <span class="font-medium" x-text="getDurationLabel(selectedDuration)"></span></p>
                    <div class="flex items-center justify-between bg-white p-4 rounded-lg border-2 border-gray-200">
                        <span x-text="generatedLink" class="text-primary-600 font-medium truncate text-sm md:text-base"></span>
                        <button @click="copyToClipboard()" class="ml-3 text-primary-600 hover:text-primary-800 transition" x-tooltip="copied ? 'Copied!' : 'Copy'">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                    </div>
                    <p x-show="copied" class="text-green-500 text-sm mt-2 animate__animated animate__fadeIn">Copied to clipboard!</p>
                </div>
                
                <div class="flex space-x-4">
                    <button @click="createNew()" class="flex-1 bg-white text-gray-800 py-3 px-4 rounded-xl font-medium transition hover:bg-gray-50 shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        New
                    </button>
                    <button @click="shareLink()" class="flex-1 btn-primary text-white py-3 px-4 rounded-xl font-medium transition shadow-md flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                        </svg>
                        Share
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-20 text-center">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <a href="#" class="text-gray-500 hover:text-primary-600 transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.477 2 2 6.477 2 12c0 5.523 4.477 10 10 10s10-4.477 10-10c0-5.523-4.477-10-10-10zm-2 15.5v-7l6 3.5-6 3.5z"></path>
                    </svg>
                </a>
                <a href="#" class="text-gray-500 hover:text-primary-600 transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.495v-9.294h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z"></path>
                    </svg>
                </a>
                <a href="#" class="text-gray-500 hover:text-primary-600 transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 10.054 10.054 0 01-3.127 1.184 4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path>
                    </svg>
                </a>
            </div>
            <p class="text-gray-500 text-sm">Powered by <span class="font-medium text-primary-600">Empire Tech</span></p>
            <p class="text-gray-400 text-xs mt-1">Only for Nigerians</p>
        </footer>
    </div>

    <script>
        function app() {
            return {
                step: 1,
                name: '',
                selectedDuration: null,
                loading: false,
                generatedLink: '',
                copied: false,
                durations: [
                    { value: 5, label: '5m' },
                    { value: 10, label: '10m' },
                    { value: 30, label: '30m' },
                    { value: 60, label: '1h' },
                    { value: 300, label: '5h' },
                    { value: 720, label: '12h' },
                    { value: 1440, label: '1d' },
                    { value: 2880, label: '2d' }
                ],
                
                init() {
                    // Check if we're on a session page
                    if (window.location.pathname.startsWith('/session/')) {
                        this.showContactForm();
                    }
                },
                
                getDurationLabel(minutes) {
                    const duration = this.durations.find(d => d.value === minutes);
                    return duration ? duration.label.replace('m', ' mins').replace('h', ' hours').replace('d', ' days') : '';
                },
                
                async createSession() {
                    if (!this.name || !this.selectedDuration) return;
                    
                    this.loading = true;
                    
                    try {
                        const response = await fetch('/api/sessions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                name: this.name,
                                duration: this.selectedDuration
                            })
                        });
                        
                        if (!response.ok) throw new Error('Failed to create session');
                        
                        const data = await response.json();
                        this.generatedLink = `${window.location.origin}/session/${data.sessionId}`;
                        this.step = 2;
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Failed to create session. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                },
                
                copyToClipboard() {
                    navigator.clipboard.writeText(this.generatedLink);
                    this.copied = true;
                    setTimeout(() => this.copied = false, 2000);
                },
                
                createNew() {
                    this.step = 1;
                    this.name = '';
                    this.selectedDuration = null;
                    this.copied = false;
                },
                
                shareLink() {
                    if (navigator.share) {
                        navigator.share({
                            title: 'Add me to your contacts',
                            text: `Please add me to your contacts. This link expires in ${this.getDurationLabel(this.selectedDuration)}.`,
                            url: this.generatedLink
                        }).catch(err => {
                            console.log('Error sharing:', err);
                            this.copyToClipboard();
                        });
                    } else {
                        this.copyToClipboard();
                    }
                },
                
                showContactForm() {
                    // This would be handled by your backend in a real app
                    const sessionId = window.location.pathname.split('/')[2];
                    
                    fetch(`/api/sessions/${sessionId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                document.body.innerHTML = `
                                    <div class="container mx-auto px-4 py-12 max-w-md text-center">
                                        <div class="card p-8 rounded-2xl">
                                            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                                <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </div>
                                            <h2 class="text-2xl font-semibold text-gray-800 mb-3">Link Expired</h2>
                                            <p class="text-gray-600 mb-6">This contact link has expired or doesn't exist.</p>
                                            <a href="/" class="btn-primary inline-block text-white py-3 px-6 rounded-xl font-semibold transition">
                                                Create New Link
                                            </a>
                                        </div>
                                    </div>
                                `;
                                return;
                            }
                            
                            document.body.innerHTML = `
                                <div class="container mx-auto px-4 py-12 max-w-md">
                                    <div class="card rounded-2xl p-8 animate__animated animate__fadeIn">
                                        <div class="text-center mb-8">
                                            <h2 class="text-2xl font-semibold text-gray-800" id="contact-name">${data.name}</h2>
                                            <p class="text-gray-500 mt-2">Expires in: ${this.getDurationLabel(data.duration)}</p>
                                            <div class="mt-4 flex justify-center space-x-2" id="time-remaining">
                                                <div class="bg-primary-100 text-primary-800 py-1 px-3 rounded-full text-sm font-medium">
                                                    <span id="hours">00</span>h
                                                </div>
                                                <div class="bg-primary-100 text-primary-800 py-1 px-3 rounded-full text-sm font-medium">
                                                    <span id="minutes">00</span>m
                                                </div>
                                                <div class="bg-primary-100 text-primary-800 py-1 px-3 rounded-full text-sm font-medium">
                                                    <span id="seconds">00</span>s
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <form id="contact-form" class="space-y-5">
                                            <div>
                                                <label class="block text-gray-700 mb-2 font-medium" for="full-name">Your Name</label>
                                                <div class="relative">
                                                    <input 
                                                        type="text" 
                                                        id="full-name" 
                                                        class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary-200 focus:border-primary-500 outline-none transition placeholder-gray-400"
                                                        placeholder="Enter your full name"
                                                        required
                                                    >
                                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-gray-700 mb-2 font-medium" for="phone">Phone Number</label>
                                                <div class="relative">
                                                    <input 
                                                        type="tel" 
                                                        id="phone" 
                                                        class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-primary-200 focus:border-primary-500 outline-none transition placeholder-gray-400"
                                                        placeholder="+234XXXXXXXXXX"
                                                        required
                                                        pattern="^\+234[0-9]{10}$"
                                                        title="Please enter a valid Nigerian phone number starting with +234"
                                                    >
                                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">Format: +234XXXXXXXXXX</p>
                                            </div>
                                            
                                            <button 
                                                type="submit" 
                                                class="btn-primary w-full text-white py-4 px-6 rounded-xl font-semibold transition-all flex items-center justify-center shadow-lg mt-6">
                                                <span id="submit-text">Add My Contact</span>
                                                <svg id="submit-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                            </button>
                                        </form>
                                        
                                        <div class="mt-8 text-center">
                                            <a href="#" class="text-primary-600 hover:underline font-medium inline-flex items-center">
                                                <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"></path>
                                                </svg>
                                                Join Our WhatsApp Channel
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <footer class="mt-12 text-center">
                                        <p class="text-gray-500 text-sm">Powered by <span class="font-medium text-primary-600">Empire Tech</span></p>
                                        <p class="text-gray-400 text-xs mt-1">Only for Nigerians</p>
                                    </footer>
                                </div>
                            `;
                            
                            // Set up countdown timer
                            const expiresAt = new Date(data.expiresAt);
                            this.setupCountdown(expiresAt);
                            
                            // Handle form submission
                            document.getElementById('contact-form').addEventListener('submit', async (e) => {
                                e.preventDefault();
                                
                                const submitText = document.getElementById('submit-text');
                                const spinner = document.getElementById('submit-spinner');
                                const fullName = document.getElementById('full-name').value;
                                const phone = document.getElementById('phone').value;
                                
                                submitText.textContent = 'Processing...';
                                spinner.classList.remove('hidden');
                                
                                try {
                                    const response = await fetch(`/api/sessions/${sessionId}/contacts`, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            fullName,
                                            phone
                                        })
                                    });
                                    
                                    if (!response.ok) throw new Error('Failed to submit contact');
                                    
                                    submitText.textContent = 'Contact Added!';
                                    spinner.classList.add('hidden');
                                    
                                    // Show success message
                                    setTimeout(() => {
                                        alert('Your contact has been added successfully!');
                                        document.getElementById('full-name').value = '';
                                        document.getElementById('phone').value = '';
                                        submitText.textContent = 'Add My Contact';
                                    }, 1000);
                                } catch (error) {
                                    console.error('Error:', error);
                                    alert('Failed to add contact. Please try again.');
                                    submitText.textContent = 'Add My Contact';
                                    spinner.classList.add('hidden');
                                }
                            });
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            document.body.innerHTML = `
                                <div class="container mx-auto px-4 py-12 max-w-md text-center">
                                    <div class="card p-8 rounded-2xl">
                                        <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                            </svg>
                                        </div>
                                        <h2 class="text-2xl font-semibold text-gray-800 mb-3">Error Loading</h2>
                                        <p class="text-gray-600 mb-6">There was an error loading this contact link.</p>
                                        <a href="/" class="btn-primary inline-block text-white py-3 px-6 rounded-xl font-semibold transition">
                                            Go Back Home
                                        </a>
                                    </div>
                                </div>
                            `;
                        });
                },
                
                setupCountdown(expiresAt) {
                    function updateCountdown() {
                        const now = new Date();
                        const diff = expiresAt - now;
                        
                        if (diff <= 0) {
                            document.getElementById('time-remaining').innerHTML = `
                                <div class="bg-red-100 text-red-800 py-1 px-3 rounded-full text-sm font-medium">
                                    Expired
                                </div>
                            `;
                            document.getElementById('contact-form').querySelector('button').disabled = true;
                            return;
                        }
                        
                        const hours = Math.floor(diff / (1000 * 60 * 60));
                        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                        
                        document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                        document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                        document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                    }
                    
                    updateCountdown();
                    setInterval(updateCountdown, 1000);
                }
            }
        }
    </script>
</body>
</html>
